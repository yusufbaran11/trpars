name: TRPars 26.0 Beta Build

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Gerekli paketleri yÃ¼kle
        run: |
          sudo apt-get update
          sudo apt-get install -y debootstrap squashfs-tools xorriso isolinux syslinux-common live-boot live-config
      
      - name: Dizinleri oluÅŸtur
        run: |
          mkdir -p build/chroot
          mkdir -p build/image/casper
          mkdir -p build/image/isolinux
          mkdir -p build/image/boot/grub
          mkdir -p output
      
      - name: Debian rootfs oluÅŸtur
        run: |
          sudo debootstrap --arch amd64 --variant=minbase trixie build/chroot http://deb.debian.org/debian
      
      - name: Paket kaynaÄŸÄ±nÄ± gÃ¼ncelle
        run: |
          sudo tee build/chroot/etc/apt/sources.list > /dev/null << 'EOF'
          deb http://deb.debian.org/debian trixie main contrib non-free-firmware
          deb http://security.debian.org trixie-security main contrib non-free-firmware
          EOF
      
      - name: Kernel ve live-boot kur
        run: |
          sudo chroot build/chroot apt-get update
          sudo chroot build/chroot apt-get install -y linux-image-amd64 live-boot live-config
      
      - name: Cinnamon masaÃ¼stÃ¼ ortamÄ±nÄ± kur
        run: |
          sudo chroot build/chroot apt-get install -y cinnamon cinnamon-session lightdm lightdm-gtk-greeter xserver-xorg xserver-xorg-input-all xserver-xorg-video-all
      
      - name: UygulamalarÄ± kur
        run: |
          sudo chroot build/chroot apt-get install -y chromium thunderbird vlc gedit nautilus gparted synaptic htop curl wget git fonts-liberation fonts-dejavu fonts-noto locales
      
      - name: TÃ¼rkÃ§e locale yapÄ±landÄ±rmasÄ±
        run: |
          sudo chroot build/chroot sed -i 's/^# tr_TR.UTF-8/tr_TR.UTF-8/' /etc/locale.gen
          sudo chroot build/chroot locale-gen tr_TR.UTF-8
          sudo chroot build/chroot update-locale LANG=tr_TR.UTF-8
      
      - name: KullanÄ±cÄ± oluÅŸtur
        run: |
          sudo chroot build/chroot useradd -m -s /bin/bash trpars
          sudo chroot build/chroot usermod -aG sudo trpars
          echo "trpars:trpars" | sudo chroot build/chroot chpasswd
      
      - name: Hostname ayarla
        run: |
          echo "trpars" | sudo tee build/chroot/etc/hostname > /dev/null
      
      - name: LightDM yapÄ±landÄ±rmasÄ±
        run: |
          sudo mkdir -p build/chroot/etc/lightdm/lightdm.conf.d
          sudo tee build/chroot/etc/lightdm/lightdm.conf.d/01_trpars.conf > /dev/null << 'EOF'
          [General]
          session=cinnamon
          autologin-user=trpars
          autologin-user-timeout=0
          user-session=cinnamon
          greeter-session=lightdm-gtk-greeter
          EOF
      
      - name: Fstab oluÅŸtur
        run: |
          sudo tee build/chroot/etc/fstab > /dev/null << 'EOF'
          /dev/root / ext4 rw,relatime 0 1
          tmpfs /tmp tmpfs defaults,nosuid,nodev,noexec,relatime,size=50% 0 0
          tmpfs /run tmpfs defaults,nosuid,nodev,mode=755 0 0
          EOF
      
      - name: Sistem temizliÄŸi
        run: |
          sudo chroot build/chroot apt-get autoremove -y
          sudo chroot build/chroot apt-get autoclean -y
          sudo chroot build/chroot apt-get clean -y
          sudo find build/chroot/var/log -type f -name "*.log" -delete
          sudo find build/chroot/tmp -type f -delete
          sudo find build/chroot/var/tmp -type f -delete
      
      - name: Squashfs dosyasÄ± oluÅŸtur
        run: |
          sudo mksquashfs build/chroot build/image/casper/filesystem.squashfs -comp xz -e boot -wildcards
      
      - name: Manifest dosyasÄ± oluÅŸtur
        run: |
          sudo bash -c 'dpkg-query -W -f='${Package} ${Version}\n' > build/image/casper/filesystem.manifest'
      
      - name: Kernel ve initramfs kopyala
        run: |
          sudo cp build/chroot/boot/vmlinuz-* build/image/casper/vmlinuz
          sudo cp build/chroot/boot/initrd.img-* build/image/casper/initrd.img
          sudo chown -R $USER:$USER build/image/
      
      - name: ISOLINUX bootloader yapÄ±landÄ±rmasÄ±
        run: |
          sudo cp /usr/lib/ISOLINUX/isolinux.bin build/image/isolinux/
          sudo cp /usr/lib/syslinux/modules/bios/ldlinux.c32 build/image/isolinux/
          sudo cp /usr/lib/syslinux/modules/bios/libutil.c32 build/image/isolinux/
          
          sudo tee build/image/isolinux/isolinux.cfg > /dev/null << 'EOF'
          DEFAULT menu.c32
          PROMPT 0
          TIMEOUT 300
          
          MENU TITLE TRPars 26.0 Beta
          MENU COLOR border       30;44   #ffffffff #00000000
          MENU COLOR title        1;36;44 #ffffffff #00000000
          MENU COLOR sel          7;37;40 #ffffffff #00000000
          MENU COLOR hotsel       1;7;37;40 #ffffffff #00000000
          MENU COLOR disabled      1;30;44 #60cccccc #00000000
          MENU COLOR scrollbar     30;44   #ffffffff #00000000
          MENU COLOR tabmsg        31;40   #ffffffff #00000000
          MENU COLOR cmdline       37;40   #ffffffff #00000000
          MENU SEPARATOR
          MENU SEPARATOR
          
          LABEL TRPars
            MENU LABEL TRPars 26.0 Beta (Live)
            KERNEL /casper/vmlinuz
            APPEND initrd=/casper/initrd.img boot=casper quiet splash
          
          LABEL TRParsnoX
            MENU LABEL TRPars 26.0 Beta (CLI Mod)
            KERNEL /casper/vmlinuz
            APPEND initrd=/casper/initrd.img boot=casper text
          
          LABEL memtest
            MENU LABEL Bellek Testi
            KERNEL /casper/memtest
          EOF
      
      - name: GRUB bootloader yapÄ±landÄ±rmasÄ±
        run: |
          sudo tee build/image/boot/grub/grub.cfg > /dev/null << 'EOF'
          set default=0
          set timeout=10
          set gfxmode=auto
          insmod gfxterm
          terminal_output gfxterm
          
          menuentry "TRPars 26.0 Beta (Live)" {
            set gfxpayload=keep
            linux /casper/vmlinuz boot=casper quiet splash
            initrd /casper/initrd.img
          }
          
          menuentry "TRPars 26.0 Beta (CLI Mod)" {
            linux /casper/vmlinuz boot=casper text
            initrd /casper/initrd.img
          }
          EOF
      
      - name: README dosyasÄ±
        run: |
          sudo tee build/image/README.txt > /dev/null << 'EOF'
          â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—
          â•‘          TRPars 26.0 Beta - Live Linux DaÄŸÄ±tÄ±mÄ±          â•‘
          â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          
          ğŸ“‹ DAÄITIM BÄ°LGÄ°LERÄ°
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          â€¢ AdÄ±: TRPars
          â€¢ SÃ¼rÃ¼m: 26.0 Beta
          â€¢ Temel: Debian 13.2 (Trixie)
          â€¢ MasaÃ¼stÃ¼: Cinnamon
          â€¢ Dil: TÃ¼rkÃ§e
          â€¢ Boot: BIOS/UEFI uyumlu
          
          ğŸ¯ AMAÃ‡
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          Linux'a yeni geÃ§enlere kullanÄ±cÄ± dostu, kolay kurulum saÄŸlamak
          
          ğŸ’» SÄ°STEM GEREKSÄ°NÄ°MLERÄ°
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          â€¢ RAM: En az 2 GB
          â€¢ Disk: 20 GB (kurulum iÃ§in)
          â€¢ Ä°ÅŸlemci: 64-bit (x86_64)
          
          ğŸ› ï¸ KURULU YAZILIMLAR
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          âœ“ MasaÃ¼stÃ¼: Cinnamon, LightDM
          âœ“ Web: Chromium
          âœ“ E-posta: Thunderbird
          âœ“ Multimedya: VLC
          âœ“ AraÃ§lar: Gparted, Gedit, Nautilus, Synaptic, Htop
          
          ğŸ‘¤ VARSAYILAN KULLANÄ°CÄ°
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          â€¢ KullanÄ±cÄ± AdÄ±: trpars
          â€¢ Åifre: trpars
          
          ğŸš€ KULLANIM
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          1. ISO'yu USB'ye yazÄ±n:
             Linux: sudo dd if=TRPars-26.0-Beta-amd64.iso of=/dev/sdX bs=4M sync
             Windows: Etcher veya Rufus kullanÄ±n
          
          2. BilgisayarÄ± USB'den boot edin
          
          3. CanlÄ± ortamda test edin
          
          4. Sisteme kurmak iÃ§in "Kurulum" seÃ§eneÄŸini tÄ±klayÄ±n
          
          ğŸ“ NOTLAR
          â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
          â€¢ CanlÄ± ortamda yapÄ±lan deÄŸiÅŸiklikler kalÄ±cÄ± deÄŸildir
          â€¢ Kurulum sonrasÄ± ÅŸifrenizi mutlaka deÄŸiÅŸtirin
          â€¢ Paket yÃ¶neticisinden (Synaptic) ek yazÄ±lÄ±m yÃ¼kleyebilirsiniz
          
          â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
          EOF
      
      - name: ISO imajÄ± oluÅŸtur
        run: |
          xorriso -as mkisofs \
            -iso-level 3 \
            -full-iso9660-filenames \
            -volid "TRPars-260-Beta" \
            -output output/TRPars-26.0-Beta-amd64.iso \
            -eltorito-boot isolinux/isolinux.bin \
            -eltorito-catalog isolinux/boot.cat \
            -no-emul-boot \
            -boot-load-size 4 \
            -boot-info-table \
            -eltorito-alt-boot \
            -e boot/efi.img \
            -no-emul-boot \
            -isohybrid-gpt-basdat \
            build/image
      
      - name: SHA256 checksum oluÅŸtur
        run: cd output && sha256sum TRPars-26.0-Beta-amd64.iso > TRPars-26.0-Beta-amd64.iso.sha256
      
      - name: Artifacts upload
        uses: actions/upload-artifact@v4
        with:
          name: TRPars-26.0-Beta
          path: output/
          retention-days: 90
      
      - name: Build Ã¶zeti
        run: |
          echo "âœ… TRPars 26.0 Beta baÅŸarÄ±yla oluÅŸturuldu!"
          echo ""
          echo "ğŸ“ Dosya Boyutu:"
          ls -lh output/TRPars-26.0-Beta-amd64.iso
          echo ""
          echo "ğŸ” SHA256 Checksum:"
          cat output/TRPars-26.0-Beta-amd64.iso.sha256
