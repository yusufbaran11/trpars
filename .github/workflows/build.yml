name: TRPars 26.0 Beta Build

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4
      
      - name: Paketler yÃ¼kle
        run: sudo apt-get update && sudo apt-get install -y debootstrap squashfs-tools xorriso
      
      - name: Dizinler oluÅŸtur
        run: mkdir -p build/chroot build/iso/boot/grub build/iso/live output
      
      - name: Debian rootfs oluÅŸtur
        run: sudo debootstrap --arch amd64 --variant=minbase trixie build/chroot http://deb.debian.org/debian
      
      - name: Kernel kur
        run: sudo chroot build/chroot apt-get update && sudo chroot build/chroot apt-get install -y linux-image-amd64 grub-pc-bin
      
      - name: Cinnamon kur
        run: sudo chroot build/chroot apt-get install -y cinnamon lightdm lightdm-gtk-greeter xserver-xorg
      
      - name: Uygulamalar kur
        run: sudo chroot build/chroot apt-get install -y chromium thunderbird vlc gedit nautilus gparted synaptic htop curl wget git fonts-liberation fonts-dejavu fonts-noto locales
      
      - name: Locale ayarla
        run: sudo chroot build/chroot sed -i 's/^# tr_TR.UTF-8/tr_TR.UTF-8/' /etc/locale.gen && sudo chroot build/chroot locale-gen tr_TR.UTF-8
      
      - name: KullanÄ±cÄ± oluÅŸtur
        run: sudo chroot build/chroot useradd -m -s /bin/bash trpars && sudo chroot build/chroot usermod -aG sudo trpars && echo "trpars:trpars" | sudo chroot build/chroot chpasswd
      
      - name: Hostname ayarla
        run: echo "trpars" | sudo tee build/chroot/etc/hostname > /dev/null
      
      - name: LightDM config
        run: |
          sudo mkdir -p build/chroot/etc/lightdm/lightdm.conf.d
          sudo tee build/chroot/etc/lightdm/lightdm.conf.d/01_trpars.conf > /dev/null << 'LIGHTDMEOF'
          [General]
          session=cinnamon
          autologin-user=trpars
          LIGHTDMEOF
      
      - name: Temizle
        run: sudo chroot build/chroot apt-get autoremove -y && sudo chroot build/chroot apt-get clean -y
      
      - name: Squashfs oluÅŸtur
        run: sudo mksquashfs build/chroot build/iso/live/filesystem.squashfs -comp xz -e boot
      
      - name: Boot dosyalarÄ± kopyala
        run: sudo cp build/chroot/boot/vmlinuz-* build/iso/boot/vmlinuz 2>/dev/null || true && sudo cp build/chroot/boot/initrd.img-* build/iso/boot/initrd.img 2>/dev/null || true && sudo chown -R $USER:$USER build/iso/
      
grub.cfg -no-emul-boot -boot-load-size 4 -boot-info-table -output output/TRPars-26.0-Beta-amd64.iso build/iso/
      
      - name: Checksum oluÅŸtur
        run: cd output && sha256sum TRPars-26.0-Beta-amd64.iso > TRPars-26.0-Beta-amd64.iso.sha256
      
      - name: Info dosyasÄ± oluÅŸtur
        run: |
          tee output/README.txt > /dev/null << 'READMEEOF'
          TRPars 26.0 Beta
          ================
          
          DaÄŸÄ±tÄ±m: Debian 13.2 TabanlÄ±
          MasaÃ¼stÃ¼: Cinnamon
          AmaÃ§: Linux'a yeni geÃ§enlere kolaylÄ±k saÄŸlamak
          
          Kurulu YazÄ±lÄ±mlar:
          - Chromium (Web tarayÄ±cÄ±)
          - Thunderbird (E-posta)
          - VLC (Video oynatÄ±cÄ±)
          - Gparted (Disk bÃ¶lÃ¼mlendirme)
          - Gedit (Metin editÃ¶rÃ¼)
          - Nautilus (Dosya yÃ¶neticisi)
          - Synaptic (Paket yÃ¶neticisi)
          
          VarsayÄ±lan KullanÄ±cÄ±: trpars
          Åžifre: trpars
          
          Kurulum:
          1. USB'ye yazÄ±n: sudo dd if=TRPars-26.0-Beta-amd64.iso of=/dev/sdX bs=4M
          2. USB'den boot edin
          3. Sisteme Kur
          READMEEOF
      
      - name: Artifacts upload
        uses: actions/upload-artifact@v4
        with:
          name: TRPars-26.0-Beta
          path: output/
          retention-days: 90
      
      - name: Ã–zet
        run: |
          echo "âœ… TRPars 26.0 Beta Build TamamlandÄ±!"
          echo ""
          echo "ðŸ“ OluÅŸturulan Dosyalar:"
          ls -lh output/
          echo ""
          echo "ðŸ’¾ Artifacts'tan indirin"
